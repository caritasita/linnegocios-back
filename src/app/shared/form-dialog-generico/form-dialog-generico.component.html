<h4 mat-dialog-title>{{ titleDialog }}</h4>

<mat-dialog-content class="pt-4">
  <form [formGroup]="form">
    <div *ngFor="let grupo of fields" class="form-container">
      <div *ngFor="let field of grupo" class="{{field.fillColumn}}">
        @if (['text', 'number', 'email', 'tel'].includes(field.type) && !field.hideInput) {
          <mat-form-field appearance="outline"
                          class="width-content">
            <mat-label>{{ field.label | uppercase }}</mat-label>
            <input matInput
                   [type]="field.type"
                   [formControlName]="field.name"
                   (keydown)="onKeydown($event)"
                   [maxlength]="field?.maxLenght || 10000"
            >

            <!-- Bot贸n para limpiar el campo -->
            <button *ngIf="form.get(field.name)?.value && (!data.id || field.name !== 'clave')"
                    matSuffix mat-icon-button aria-label="Clear"
                    (click)="form.get(field.name)?.setValue(''); clearField(field.name)">
              <mat-icon>close</mat-icon>
            </button>
            <!-- Componente para mostrar mensajes de validaci贸n -->
            <mat-error *ngIf="form.get(field.name)?.invalid && (form.get(field.name)?.dirty || form.get(field.name)?.touched)">
              <app-form-errors [control]="form.get(field.name)"></app-form-errors>
            </mat-error>

          </mat-form-field>
        }

        @if (field.type === 'file' && !field.hideInput) {
          <mat-card class="container quitar-estilo-default-card">
            <div class="image-preview" *ngIf="imagePreview">
              <img [src]="imagePreview" alt="Vista previa de la imagen"/>
            </div>
            <div>
              <button
                mat-raised-button
                color="primary"
                (click)="fileInput.click()">
                Seleccionar imagen
              </button>
              <input
                #fileInput type="file"
                accept="image/*"
                style="display: none"
                (change)="onImagePicked($event)"
              />
            </div>
          </mat-card>
        }

        <mat-form-field *ngIf="field.type === 'select' && !field.hideInput" class="width-content" appearance="outline">
          <mat-label>{{ field.label | uppercase }}</mat-label>
          <mat-select [formControlName]="field.name">
            <mat-select-trigger>
              {{ getLabelForValue(field, form.get(field.name)?.value) || 'Selecciona una opci贸n' }}
            </mat-select-trigger>

            <mat-option>
              <ngx-mat-select-search [formControl]="searchControls[field.name]" placeholderLabel="Buscar..."
                                     noEntriesFoundLabel="No se encontraron resultados"></ngx-mat-select-search>
            </mat-option>

            @for (option of filteredOptions[field.name]; track option) {
              <mat-option [value]="option.value" [innerText]="option.label">{{ option.label }}</mat-option>
            }
          </mat-select>
          <!-- Componente para mostrar mensajes de validaci贸n -->
          <mat-error *ngIf="form.get(field.name)?.invalid && (form.get(field.name)?.dirty || form.get(field.name)?.touched)">
            <app-form-errors [control]="form.get(field.name)"></app-form-errors>
          </mat-error>
        </mat-form-field>

        <mat-slide-toggle *ngIf="field.type === 'toggle' && !field.hideInput" [formControlName]="field.name">{{field.label}}</mat-slide-toggle>

      </div>
    </div>
  </form>
</mat-dialog-content>
<mat-dialog-actions>
  <button class="boton-bg-primario" mat-stroked-button (click)="onClose()">Cancelar</button>
  <button mat-flat-button class="boton-bg-primario" type="submit" [disabled]="form.invalid"
          (click)="onSubmit()">{{ data.id ? 'Actualizar' : 'Guardar' }}
  </button>
</mat-dialog-actions>
